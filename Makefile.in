BINDIR = @BINDIR@
LIBDIR = @LIBDIR@
SYSCONFDIR = @SYSCONFDIR@
MANDIR = @MANDIR@
DATADIR = @DATADIR@
DEBCONFIGDIR = @DEBCONFIGDIR@

POD2MAN = @POD2MAN@
MSGFMT = @MSGFMT@

VERSION = @VERSION@

LANGUAGES = @LANGUAGES@

HOME_DIR = /home/$(USER)
OUT_SCRIPT = debbuild.out

.DEFAULT_GOAL := build
.PHONY: build
build: $(OUT_SCRIPT)

$(OUT_SCRIPT): debbuild
	cp debbuild $(OUT_SCRIPT)
	echo "\
version:$(VERSION)\n\
debconfigdir:$(DEBCONFIGDIR)\n\
sysconfdir:$(SYSCONFDIR)" >> $(OUT_SCRIPT)
	chmod +x $(OUT_SCRIPT)

.PHONY: check
check:
	yath

.PHONY: install
install:
	rm -rf $(DESTDIR)

	install -d $(DESTDIR)$(BINDIR)
	install $(OUT_SCRIPT) $(DESTDIR)$(BINDIR)/debbuild

	install -d $(DESTDIR)$(DEBCONFIGDIR)
	install -m 644 macros/macros.in $(DESTDIR)$(DEBCONFIGDIR)/macros
	install -m 644 config/debrc $(DESTDIR)$(DEBCONFIGDIR)

	install -m 755 scripts/find-lang.pl $(DESTDIR)$(DEBCONFIGDIR)

	install -d $(DESTDIR)$(DEBCONFIGDIR)/macros.d
	install -m 644 macros/macros.sysutils $(DESTDIR)$(DEBCONFIGDIR)/macros.d
	install -m 644 macros/macros.texlive $(DESTDIR)$(DEBCONFIGDIR)/macros.d
	install -m 644 macros/platform.in $(DESTDIR)$(DEBCONFIGDIR)/macros.d/macros.00platform

	install -d $(DESTDIR)$(MANDIR)/man8
	$(POD2MAN) --utf8 --center="System Manager's Manual" --section 8 \
		--release="Release $(VERSION)" debbuild \
		$(DESTDIR)$(MANDIR)/man8/debbuild.8

	for lang in $(LANGUAGES) ; do \
		install -d $(DESTDIR)$(DATADIR)/locale/$$lang/LC_MESSAGES ; \
		$(MSGFMT) po/$$lang/debbuild.po -o $(DESTDIR)$(DATADIR)/locale/$$lang/LC_MESSAGES/debbuild.mo ; \
	done
